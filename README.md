# Current [![C++](https://img.shields.io/badge/c%2B%2B-17-informational.svg)](https://en.cppreference.com/w/cpp/17) [![MIT license](https://img.shields.io/badge/License-MIT-blue.svg)](https://mit-license.org/)

[![tests](https://github.com/C5T/Current/actions/workflows/tests.yml/badge.svg?branch=stable)](https://github.com/C5T/Current/actions/workflows/tests.yml?query=branch%3Astable) [![cmake](https://github.com/C5T/Current/actions/workflows/cmake.yml/badge.svg?branch=stable)](https://github.com/C5T/Current/actions/workflows/cmake.yml?query=branch%3Astable)

As of April 2024, Current has seen **10000 pull requests**. And counting!

## `cmake`

As of 2024, we are making Current more `cmake`-friendly.

The core paradigms of Current stay the same, namely:

* Make it easy to develop in C++ with current.
* The code should be self-explicable and hard to make a mistake in. 

In practical terms, the trasition to `cmake` means even easier integration for user code. For an example, consider [this one](https://github.com/dkorolev/c5t_trivial_dep_example). The TL;DR: on how to start a Current-first C++ project in a few minutes is:

* Start a repository.
* Grab the `Makefile` into its root cirectory, copying it from [`C5T/Current/stable/cmake/Makefile`](https://github.com/C5T/Current/blob/stable/cmake/Makefile).
* Add a [`.gitognore`](https://github.com/dkorolev/c5t_trivial_dep_example/blob/main/.gitignore) file, with ``CMakeLists.txt`, `current/`, `googletest/`, and `.current/` + `.current_debug/`.
* Put your `*.cc` source files under `src/`, and
* Just `make` would do the job.

This approach is a bit unorthodox, since it invokes `make` to run a `cmake`-based build. On the other hand, this default `Makefile` will grab the latest `CMakeLists.txt` from `C5T/Current`, this default `Makefile` offers all the standard `debug/release/clean/test` targets, including a few other useful ones such as `fmt`, and this default `Makefile` makes vim the natural IDE of choice for C++ projects! =)

## Components

#### [TypeSystem](https://github.com/C5T/Current/blob/stable/typesystem/README.md)
The type system used in Current framework. Built in reflection (even for templates!) while staying compatible with the native C++ data structures.

#### [Bricks](https://github.com/C5T/Current/blob/stable/bricks/README.md)
JSON and binary serialization, string manipulation library, command line flags library, low-level system wrappers, and other core pieces.

#### [Blocks](https://github.com/C5T/Current/blob/stable/blocks/README.md)
HTTP server and client, efficient in-memory message queue, persistence layer, streaming API interface.

#### [Stream](https://github.com/C5T/Current/blob/stable/stream/README.md)
Structured, append-only, immutable data persistence layer with publish-subscribe.

#### [Storage](https://github.com/C5T/Current/blob/stable/storage/REST-API.md)
Super easy to use in-memory transactional object store with Stream-based persistence. Simple pub-sub powered distributed system scaling via eventually consistent read-only replicas.

#### [Type Evolution](https://github.com/C5T/Current/blob/stable/typesystem/Evolution.md)
Compact and autogenerated C++ framework to evolve objects from one type hierarchy into another type hierarchy while remaining fully within the strong typing paradigm.

#### [RipCurrent](https://github.com/C5T/Current/blob/stable/ripcurrent/README.md)
The language to define continuous data pipelines.

#### [FnCAS](https://github.com/C5T/Current/blob/stable/fncas/README.md)
An efficient convex optimization engine.

#### [CompactTSV](https://github.com/C5T/Current/blob/stable/compact_tsv/)
Low-level compact persistence layer with 1+ GB/s throughput.

#### [EventCollector](https://github.com/C5T/Current/blob/stable/event_collector/README.md)
An extensible event collecting HTTP server.

## Contribution

Welcome, contributors! Please [start here by signing the CLA](https://github.com/C5T/Current/blob/stable/contributors/README.md).

## Quick Start

### Install the development dependencies

- `nasm` for `FnCAS`.
  - **macOS**: `brew install nasm`
- `geninfo` from `lcov` for coverage report.
  - **macOS**: `brew install lcov`
- `clang-format-10` for code formatting (`make indent`).
  - TODO(dkorolev) On **macOS** no `clang-format-3.6` was availably, and the trick was to use `clang-format-3.8` and symlink it: `brew install clang-format@3.8 && ln -s /usr/local/bin/clang-format-3.6 /usr/local/opt/clang-format@3.8/bin/clang-format`, double-checking.

### Clean the output of the previous builds

```
make clean
```

### Run the tests

Builds and runs all the tests as a single binary. Slow, eats up tons of CPU, but measures coverage.
Consider `make individual_tests` or `make test` within individual directories to run the subset of tests.
```
make test
```

Builds and runs the tests for each module separately:
```
make individual_tests
```

Builds and runs the tests for one of the modules (e.g. `blocks/http`):
```
(cd blocks/http && make test)
```

### Verify the code

"Builds" all header files individually, twice each header file, and "links" these pairs together.
Ensures no symbols are exported, and the ODR will not be violated when linking together two objects, each of which is independently using Current.
```
make check
```
